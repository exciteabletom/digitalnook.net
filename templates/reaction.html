<!DOCTYPE html>
<html lang='en'>
<!-- reaction time game by Tommy Dougiamas
	TODO: -->
	<head>
		<title>Test your reactions! | DigitalNook</title>
		<link href="/static/favicon.ico/" rel="icon" type="icon/ico"/>
		<link href="/static/styles1.css" rel="stylesheet"/>
		<!--sleep function-->
		<script src="/static/scripts/sleep.js"></script>
		
		<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0"/>
		<style>
		.leftButton, .rightButton, .centerButton {margin: 5px;height: 45px; width: 45px;} /*fits red dots inside of div without overflow*/
		#submitToLeaderboard{margin:0;background: #FF6F00;left:0;right:0;bottom:0;top:0;} /*formatting for leaderboard form */
		</style>
	</head>
	<body onload="submitToLeaderboard.reset()">
		<header>
			<h1>Test your reactions!</h1>
		</header>
		<!-- All buttons for game and start button -->
		<div id="game" style="display: flex; flex-wrap: wrap; justify-content: center; align-items: center;  background: white; height: 200px; width: 20%; margin-left: 40%; margin-right: 40%; border: 5px solid black;">
			<div id='start'>
				<button type="button" id="startButton" style="visibility: visible; " onclick="resetVars(); this.style.display = 'none'; submitButton.style.display = 'none'; startGame()">Start</button>
			</div>
			<!-- sections the page into three vertical stacks, buttons floated left/right -->
			<div id="top" style="height:33%">
				<input type="image" alt="Button is not loading.." src="/static/images/dot.png" id="topLeft" class="leftButton" onclick="endTimer(); this.style.visibility = 'hidden'"/>
				<input type="image" alt="Button is not loading.." src="/static/images/dot.png" id="topCenter" class="centerButton" onclick="endTimer(); this.style.visibility = 'hidden'"/>
				<input type="image" alt="Button is not loading.." src="/static/images/dot.png" id="topRight" class="rightButton" onclick="endTimer(); this.style.visibility = 'hidden'"/>
			</div>
			<div id="middle" style="height:33%;">
				<input type="image" alt="Button is not loading.." src="/static/images/dot.png" id="middleLeft" class="leftButton" onclick="endTimer(); this.style.visibility = 'hidden'"/>
				<input type="image" alt="Button is not loading.." src="/static/images/dot.png" style="margin-right: 50px" id="middleRight" class="rightButton" onclick="endTimer(); this.style.visibility = 'hidden'"/>
				<input type="image" alt="Button is not loading.." src="/static/images/dot.png" id="middleCenter" class="centerButton" onclick="endTimer(); this.style.visibility = 'hidden'"/>
			</div>
			<div id="bottom" style="height:33%;">
				<input type="image" alt="Button is not loading.." src="/static/images/dot.png" id="bottomCenter" class="centerButton" onclick="endTimer(); this.style.visibility = 'hidden'"/>
				<input type="image" alt="Button is not loading.." src="/static/images/dot.png" id="bottomLeft" class="leftButton" onclick="endTimer(); this.style.visibility = 'hidden'"/>
				<input type="image" alt="Button is not loading.." src="/static/images/dot.png" id="bottomRight" class="rightButton" onclick="endTimer(); this.style.visibility = 'hidden'"/>
			</div>
		</div>
		<br/>
		<div id="results" style="position: relative; margin: 0px; height: 100%; width:100%">
				<h2>Results</h2>
				<p id="firstTime"></p>
				<p id="secondTime"></p>
				<p id="thirdTime"></p>
				<br/>
				<p id="finalTime"></p>
				<br/>
				<button type="button" id='submitButton' class='greenButton' style="width:30%; margin-left: 35%; margin-left: 35%; display: none;" onclick="submitToLeaderboard.style.display = 'block'">Submit score to Leaderboard</button>
		</div>
		<br/>
		<div id="footer" style="margin-top: 20px; position:relative;">
			<a href="/games">Back To Games</a>
		</div>
		<br/>
		<form id='submitToLeaderboard' autocomplete="off" action="/games/leaderboardsubmission/" method="post" style="position:fixed; height: 100vh; width: 100vw; display: none; z-index: 3; text-align: center; visiblity">
			<legend><h1>Send score to leaderboards</h1></legend>
			<p>Name:</p> <br/>
			<input style='height:10vh; width: 30vw; margin-left:35vw;margin-right:35vw;'id='nameInput' type='text' name='username' placeholder='Enter Username'><br/>
			<p>Score:</p> <br/>
			<input style='height:10vh; width: 30vw; margin-left:35vw;margin-right:35vw;' type='text' id='scoreInput' name='score' value='please finish a game before submitting' readonly='readonly'> <br/>
			<br/>
			<input class="greenButton" type='submit' value='Submit'>
		</form>
		<div id='tutorialPopup' class='overlay' style="display:block; background:#FF6F00;">
			<h1>How to Play</h1>
			<br/>
			<p>
			Click on the 3 dots as they appear. Try to get a good score! 
			<br/><br/>
			Get under 600ms average to be a champion!
			</p>
			<button class='greenButton' id="tutorialClose" style="margin-right:40%;margin-left:40%;width:20%;"onclick='tutorialPopup.style.display = "none"'>Let's Play!</button>
		</div>
		<div id='lowTimePopup' class='overlay' style="display:none; background:#FF6F00;">
			<h1>Nice Job! that is a very low time!</h1>
			<br/>
			<p id="lowTime"></p>
			<br/>
			<button class="greenButton" id="lowTimeClose" onclick="lowTimePopup.style.display = 'none';">Back to Game</button>
		</div>
	<script>
// Variables for easy access of DOM elements
const game = document.getElementById('game');
const finalTime = document.getElementById('finalTime');
const results = document.getElementById('results');
const firstTime = document.getElementById('firstTime');
const secondTime = document.getElementById('secondTime');
const thirdTime = document.getElementById('thirdTime');
const startButton = document.getElementById('startButton');
const tutorial = document.getElementById('tutorial');
const submitToLeaderboard = document.getElementById('submitToLeaderboard');
const tutorialPopup = document.getElementById('tutorialPopup');
const lowTimePopup = document.getElementById('lowTimePopup');
const lowTime = document.getElementById('lowTime');
const nameInput = document.getElementById('nameInput');
const scoreInput = document.getElementById('scoreInput');
const submitButton = document.getElementById('submitButton');

window.onload = function () {
	submitToLeaderboard.reset();	
}
// defines pop sound so that it is not delayed on button press
const popSound = new Audio('/static/audio/pop.mp3');
// stores user's reaction time
let reactionTime = 0;
// resets variables for new game
function resetVars() {
	firstTime.innerHTML = "";
	secondTime.innerHTML = "";
	thirdTime.innerHTML = "";
	finalTime.innerHTML = "";
	count = 0;
	reactionTime = 0;

}
// holds button appearance time and button click time
let startTime, endTime;
function startTimer() {
	startTime = new Date();
	console.log("timer Started");
};
// stores the fastest time
let bestReactionTime = 0;
function endTimer() {
	//pop audio on button press
	popSound.play();
	popSound.currentTime = 0;

	// adds reaction time to total for averages
	endTime = new Date();
	console.log("reaction time: " + (endTime - startTime));
	reactionTime += endTime - startTime;
	if ((endTime - startTime) < bestReactionTime) {
		bestReactionTime = endTime - startTime;
	}
	// displays times to users
	if (count === 1){
		firstTime.innerHTML = endTime - startTime + "ms";
		bestReactionTime = endTime - startTime;
		startGame();
	} else if (count === 2) {
		secondTime.innerHTML =endTime - startTime + "ms";
		startGame();
	} else if (count === 3) {
		count = 0;
		submitButton.style.display = "block"
		startButton.style.display = "inline";	
		thirdTime.innerHTML = endTime - startTime + "ms";
		finalTime.innerHTML = `Your average reaction time was ${Math.round(reactionTime/3)}ms or ${((reactionTime/3)/1000).toFixed(2)} seconds!`;
		scoreInput.value = Math.round(reactionTime/3);
		if ((reactionTime/3) <= 600) {
				lowTime.innerHTML = `Nice! <br/><br/> Average Reaction Time: ${Math.round(reactionTime/3)} ms <br/> Best Reaction Time: ${Math.round(bestReactionTime)} ms`;
		lowTimePopup.style.display = "block";	
			lowTimePopup.style.background = "red";
			sleep(400).then(() =>{
				lowTimePopup.style.background = "purple";
				sleep(400).then(() =>{
					lowTimePopup.style.background = "green";
					sleep(400).then(() =>{
						lowTimePopup.style.background = "yellow";
						sleep(400).then(() =>{
							lowTimePopup.style.background = "blue";
							sleep(400).then(() =>{
									lowTimePopup.style.background = "#FF6F00";
							});
						});
					});
				});
			});
		}
	}else {
		startGame();
	}
}
function startGame() {// runs when start button is pressed
	let randomNum, randomWaitNum; //variables for waiting/randomizing button
	count += 1
	randomNum = Math.floor((Math.random() * 9) + 1);
	randomWaitNum = Math.floor((Math.random() * 4000)+1000);
	console.log(`random num is ${randomNum}. random wait num is ${randomWaitNum}`)// for debugging
	sleep(randomWaitNum).then(() => {
		switch (randomNum) {
			case 1:
				document.getElementById("topLeft").style.visibility = "visible";
				break;
			case 2:
				document.getElementById("topCenter").style.visibility = "visible";
				break;
			case 3:
				document.getElementById("topRight").style.visibility = "visible";
				break;
			case 4:
				document.getElementById("middleLeft").style.visibility = "visible";
				break;
			case 5:
				document.getElementById("middleCenter").style.visibility = "visible";
				break;
			case 6:
				document.getElementById("middleRight").style.visibility = "visible";
				break;
			case 7:
				document.getElementById("bottomLeft").style.visibility = "visible";
				break;
			case 8:
				document.getElementById("bottomCenter").style.visibility = "visible";
				break;
			case 9:
				document.getElementById("bottomRight").style.visibility = "visible";
				break;
		} startTimer();

	});
}
	</script>
	<noscript>
		JavaScript is not working...
	</noscript>
</html>
