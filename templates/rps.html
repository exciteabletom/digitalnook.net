<!DOCTYPE html>
<html lang=en charset=utf-8>
<!-- Rock Paper Scissors by Tommy Dougiamas -->
	
<head>
	<title>Rock, Paper, Scissors!</title>
	<link href='/static/styles1.css' type='text/css' rel='stylesheet'/>
	<link rel="shortcut icon" href="/static/favicon.ico"/>
</head>
<body style='height 100vh'>
	<section>	
		<h1 id=mainHeader> Rock Paper Scissors! </h1>
	</section>
	  	<div id=buttons class='row' style>
			<div class='column' style='float:center;'>
				<input alt='image of rock' type='image' onclick="this.disabled=true; userChoice='rock'; runAllFunctions()" src='/static/images/rock.png' id='rockButton' style='width: 100%'> 
			</div>

			<div class='column'> 
				<input alt='image of paper' type='image' onclick="this.disabled=true;userChoice='paper'; runAllFunctions()" src=/static/images/paper.png id=paperButton style='width: 100%'/>
			</div>

			<div class='column'>
				<input alt='image of scissors' type='image' onclick="this.disabled=true; userChoice='scissors'; runAllFunctions();" src='/static/images/scissors.png' id='scissorsButton' style='width: 100%'/>
			</div>

		</div> 
		<div id='popup' class='overlay'>
			<img src='/static/images/win.png' alt='winner popup'/>
		</div>
		<div id='main'>	
			<h2> Results </h2>	
			<p id='p1'></p>
		      <br/>		
			<p id='p2'></p>
			<p id='p3'></p>
		      <br/>
			<a href='/games'><p class=link>Back to Games</p></a>
	              <br/>
		      <br/>
			<p class=italicsP>Note: Sound effects may not work properly on mobile devices.</p>
		</div>

<script>
// Makes variable accessable to the DOM
var userChoice;
// Gets computer random choice
let computerChoice
function getComputerChoice(){
	const random = Math.floor((Math.random() * 3)+1);
	switch(random){
		case 1:
			compChoice = "rock";
			break;
		case 2:
			compChoice = "paper";
			break;
		case 3:
			compChoice ="scissors";
			break;
	}
}

function getWinner(userChoice, compChoice){
	if (userChoice === compChoice) {
		document.getElementById('p1').innerHTML = "The game was a tie.";
		
	}else if (userChoice === 'rock'){
		if (compChoice === 'paper'){
			document.getElementById('p1').innerHTML = "Sorry, you lost";
		}else {
			document.getElementById('p1').innerHTML = "You Won!";
		}
	}else if (userChoice === 'paper'){
		if (compChoice === 'scissors'){
			document.getElementById('p1').innerHTML = "Sorry, you lost";
		}else {
			document.getElementById('p1').innerHTML = "You Won!";
		}
	}else if (userChoice === 'scissors'){
		if (compChoice === 'rock'){
			document.getElementById('p1').innerHTML = "Sorry, you lost";
		}else {
			document.getElementById('p1').innerHTML = "You Won!";
		}
	}
	console.log(`comps choice: ${compChoice}`);console.log(`users choice: ${userChoice}`) // debugging
}
//function for halting js as needed 
function sleep (time) {
	return new Promise((resolve) => setTimeout(resolve, time));
}

// executes all functions if it is not already running
function runAllFunctions(){
	// Stops button spamming
	document.getElementById('p1').innerHTML = ""
	document.getElementById('p2').innerHTML = ""
	document.getElementById('p3').innerHTML = ""
	// init for drumroll audio
	function playDrumroll(){
		let drumroll = new Audio('/static/audio/drumroll.mp3');
		drumroll.play();
		drumroll.currentTime=0;
	}
	// plays drumroll, waits, finds results and plays appropriate sfx

	playDrumroll();
	sleep(5000).then(() => {
		afterDrumroll();		
	})
	function afterDrumroll(){
		getComputerChoice()
		getWinner(userChoice, compChoice);
		document.getElementById('p3').innerHTML = `The Computers choice was ${compChoice}.`;
		document.getElementById('p2').innerHTML = `Your choice was ${userChoice.toLowerCase()}.`;
		if (document.getElementById('p1').innerHTML[0] === "S"){
			let loserSound = new Audio('/static/audio/lose.mp3');
			loserSound.play();
			loserSound.currentTime=0;
		}else if (document.getElementById('p1').innerHTML[0] === "Y"){
			let winnerSound= new Audio('/static/audio/win.mp3');
			document.getElementById('popup').style.display = "block"
			winnerSound.play();
			winnerSound.play();
			winnerSound.currentTime=0;
		}else {
			let tieSound = new Audio('/static/audio/tie.mp3');
			tieSound.play();
			tieSound.currentTime=0;
		}
		sleep(1900).then(() => { // waits 1.9 seconds then enables buttons
		document.getElementById('popup').style.display = "none"
		document.getElementById('rockButton').disabled = false;
		document.getElementById('scissorsButton').disabled = false;
		document.getElementById('paperButton').disabled = false;
		})
	}
}
</script>
<noscript>
	<p class='italicsP'>Your browser does not support JavaScript, Please enable it to view this page...</p>
</noscript>
</body>
</html>
